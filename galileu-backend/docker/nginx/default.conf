server {
    listen 80;
    server_name _;

    client_max_body_size 20m;

    # ========= API =========
    location /api/ {
        # 1. Configurações de Proxy (Passa a bola para o Django)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # Fundamental para o Django saber que o original era HTTPS (Cloudflare)
        proxy_set_header X-Forwarded-Proto $scheme;

        # 2. Conexão com o Container do Django (web)
        proxy_pass http://web:8000;

        # OBS: Removemos toda a lógica de CORS daqui. 
        # Quem vai controlar isso agora é o seu settings.py (django-cors-headers).
        # Isso evita o erro de sintaxe e o erro de "Multiple CORS headers".
    }

    # (Opcional) health check simples
    location = /healthz {
        return 200 "ok\n";
        add_header Content-Type text/plain;
    }
}